# Spotify API Security üîíüéµ

Una API completa de streaming de m√∫sica construida con principios de seguridad desde el dise√±o, implementando las mejores pr√°cticas de seguridad, arquitectura hexagonal y funcionalidades avanzadas de streaming de audio.

## üöÄ Caracter√≠sticas Principales

### üîí Seguridad Avanzada

- ‚úÖ **Autenticaci√≥n JWT** con tokens seguros y refresh tokens
- ‚úÖ **Autorizaci√≥n granular** - separaci√≥n completa por usuario
- ‚úÖ **Rate Limiting inteligente** con m√∫ltiples estrategias por endpoint
- ‚úÖ **Validaci√≥n robusta** con Joi y sanitizaci√≥n de entrada
- ‚úÖ **Headers de seguridad** completos (HSTS, CSP, CORS, etc.)
- ‚úÖ **Encriptaci√≥n bcrypt** con salt rounds configurables
- ‚úÖ **Prevenci√≥n de inyecciones** SQL y XSS
- ‚úÖ **Bloqueo de cuentas** tras intentos fallidos
- ‚úÖ **Logging de auditor√≠a** completo con Winston
- ‚úÖ **Protecci√≥n OWASP Top 10** implementada

### üèóÔ∏è Arquitectura Empresarial

- üèõÔ∏è **Arquitectura Hexagonal** (Clean Architecture)
- üì¶ **Inyecci√≥n de Dependencias** con contenedor DI personalizado
- üîÑ **Separaci√≥n de responsabilidades** clara por capas
- üìä **Logging estructurado** con Winston y rotaci√≥n de archivos
- üîç **Health Checks** y m√©tricas de sistema
- üß™ **Testing comprehensivo** preparado para Jest
- üìö **Documentaci√≥n Swagger** completa y actualizada

### üéµ Funcionalidades de Streaming

- üéß **Streaming de audio** con soporte de Range Requests
- üì± **Reproductor web** HTML5 integrado y responsivo
- ‚¨áÔ∏è **Descarga de archivos** con nombres limpios
- üéµ **Gesti√≥n de canciones** con upload seguro de archivos
- üíø **Gesti√≥n de √°lbumes** con metadatos completos
- üë§ **Perfiles de usuario** con estad√≠sticas
- üîç **B√∫squeda avanzada** con filtros y paginaci√≥n
- üìä **Contadores de reproducci√≥n** autom√°ticos
- üé® **URLs de streaming** incluidas en todas las respuestas

### üõ°Ô∏è Separaci√≥n de Usuarios

- üîê **Endpoints privados** (`/my/songs`, `/my/albums`) - solo contenido propio
- üåê **Endpoints p√∫blicos** (`/songs`, `/albums`) - solo contenido p√∫blico
- üö´ **Aislamiento completo** - usuarios no ven contenido de otros
- ‚úÖ **Validaci√≥n de propiedad** en todas las operaciones CRUD

## üìã Requisitos del Sistema

### Requisitos M√≠nimos

- **Node.js**: >= 18.0.0
- **npm**: >= 8.0.0
- **PostgreSQL**: >= 13.0
- **TypeScript**: >= 5.0.0

### Requisitos Recomendados

- **Node.js**: >= 20.0.0
- **PostgreSQL**: >= 15.0
- **RAM**: >= 4GB
- **Almacenamiento**: >= 20GB (para archivos de audio)

### Dependencias Principales

- **Express.js**: Framework web
- **TypeScript**: Tipado est√°tico
- **PostgreSQL**: Base de datos principal
- **JWT**: Autenticaci√≥n
- **Multer**: Upload de archivos
- **Joi**: Validaci√≥n de esquemas
- **Winston**: Logging estructurado
- **Bcrypt**: Encriptaci√≥n de contrase√±as

## üõ†Ô∏è Instalaci√≥n

### 1. Clonar el Repositorio

```bash
git clone https://github.com/spotify-api-security/spotify-api-security.git
cd spotify-api-security
```

### 2. Instalar Dependencias

```bash
npm install
```

### 3. Configurar Variables de Entorno

```bash
cp .env.example .env
```

Editar `.env` con tus configuraciones:

```env
# Servidor
NODE_ENV=development
PORT=3000
HOST=localhost

# Base de datos PostgreSQL
DATABASE_HOST=localhost
DATABASE_PORT=5432
DATABASE_NAME=spotify_api
DATABASE_USER=your_username
DATABASE_PASSWORD=your_password
DATABASE_SSL=false

# Seguridad JWT
JWT_SECRET=your-super-secret-jwt-key-minimum-32-characters-long
JWT_EXPIRES_IN=1h
JWT_REFRESH_EXPIRES_IN=7d

# Encriptaci√≥n
BCRYPT_ROUNDS=12

# Archivos de Audio
MAX_FILE_SIZE=52428800
UPLOAD_PATH=./uploads

# Logging
LOG_LEVEL=info
LOG_DIRECTORY=./logs

# Swagger
ENABLE_SWAGGER=true
API_BASE_URL=http://localhost:3000/api
```

### 4. Configurar Base de Datos

```bash
# Crear base de datos PostgreSQL
createdb spotify_api

# Las migraciones se ejecutan autom√°ticamente al iniciar en desarrollo
# O manualmente con:
npm run migrate:ts
```

### 5. Ejecutar la Aplicaci√≥n

```bash
# Desarrollo con hot reload
npm run dev

# Desarrollo con watch mode
npm run dev:watch

# Compilar TypeScript
npm run build

# Producci√≥n
npm start
```

### 6. Verificar Instalaci√≥n

```bash
# Health check
curl http://localhost:3000/api/health

# Documentaci√≥n Swagger
open http://localhost:3000/api/docs

# API info
curl http://localhost:3000/api
```

## üîß Configuraci√≥n Avanzada

### Configuraci√≥n por Ambiente

#### Desarrollo (`config/environments/development.env`)

```env
NODE_ENV=development
LOG_LEVEL=debug
ENABLE_SWAGGER=true
ENABLE_CORS=true
RATE_LIMIT_MAX=1000
```

#### Producci√≥n (`config/environments/production.env`)

```env
NODE_ENV=production
LOG_LEVEL=warn
ENABLE_SWAGGER=false
ENABLE_HSTS=true
ENABLE_CSP=true
DATABASE_SSL=true
RATE_LIMIT_MAX=100
```

### Configuraci√≥n de Seguridad

#### Headers de Seguridad

```typescript
// Configuraci√≥n autom√°tica incluye:
{
  "Strict-Transport-Security": "max-age=31536000; includeSubDomains",
  "Content-Security-Policy": "default-src 'self'",
  "X-Content-Type-Options": "nosniff",
  "X-Frame-Options": "DENY",
  "X-XSS-Protection": "1; mode=block",
  "Referrer-Policy": "strict-origin-when-cross-origin"
}
```

#### Rate Limiting

```typescript
// Configuraci√≥n por endpoint:
{
  "/api/auth/*": "5 requests per minute",
  "/api/*": "100 requests per 15 minutes",
  "/api/upload/*": "10 requests per hour"
}
```

## üöÄ Deployment

### Docker Deployment

#### 1. Construcci√≥n de Imagen

```bash
docker build -t spotify-api-security .
```

#### 2. Ejecutar con Docker Compose

```bash
# Desarrollo
docker-compose -f docker-compose.dev.yml up

# Producci√≥n
docker-compose up -d
```

### Deployment Manual

#### 1. Preparar Servidor

```bash
# Instalar Node.js y PostgreSQL
curl -fsSL https://deb.nodesource.com/setup_20.x | sudo -E bash -
sudo apt-get install -y nodejs postgresql postgresql-contrib

# Crear usuario de base de datos
sudo -u postgres createuser --interactive
sudo -u postgres createdb spotify_api
```

#### 2. Configurar Aplicaci√≥n

```bash
# Clonar y configurar
git clone <repository-url>
cd spotify-api-security
npm ci --production
npm run build

# Configurar variables de entorno
cp config/environments/production.env .env
# Editar .env con configuraciones de producci√≥n

# Ejecutar migraciones
npm run migrate
```

#### 3. Configurar Proceso Manager

```bash
# Instalar PM2
npm install -g pm2

# Iniciar aplicaci√≥n
pm2 start ecosystem.config.js --env production

# Configurar inicio autom√°tico
pm2 startup
pm2 save
```

### Deployment en la Nube

#### AWS Deployment

```bash
# Usar script de deployment
chmod +x scripts/deploy.sh
./scripts/deploy.sh production aws
```

#### Heroku Deployment

```bash
# Configurar Heroku
heroku create spotify-api-security
heroku addons:create heroku-postgresql:hobby-dev
heroku addons:create heroku-redis:hobby-dev

# Configurar variables de entorno
heroku config:set NODE_ENV=production
heroku config:set JWT_SECRET=your-production-secret

# Deploy
git push heroku main
```

## üìö Uso de la API

### üîê Autenticaci√≥n

#### 1. Registro de Usuario

```bash
curl -X POST http://localhost:3000/api/auth/register \
  -H "Content-Type: application/json" \
  -d '{
    "email": "usuario@ejemplo.com",
    "password": "Password123",
    "name": "Usuario Ejemplo"
  }'
```

**Respuesta:**
```json
{
  "message": "User registered successfully",
  "user": {
    "id": "uuid-123",
    "email": "usuario@ejemplo.com",
    "name": "Usuario Ejemplo",
    "role": "user",
    "createdAt": "2024-01-01T12:00:00.000Z"
  },
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
  "refreshToken": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
}
```

#### 2. Inicio de Sesi√≥n

```bash
curl -X POST http://localhost:3000/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{
    "email": "usuario@ejemplo.com",
    "password": "Password123"
  }'
```

#### 3. Renovar Token

```bash
curl -X POST http://localhost:3000/api/auth/refresh \
  -H "Content-Type: application/json" \
  -d '{
    "refreshToken": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
  }'
```

### üë§ Gesti√≥n de Usuarios

#### Obtener Perfil

```bash
curl -X GET http://localhost:3000/api/users/profile \
  -H "Authorization: Bearer YOUR_TOKEN"
```

#### Actualizar Perfil

```bash
curl -X PUT http://localhost:3000/api/users/profile \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "name": "Nuevo Nombre",
    "currentPassword": "Password123",
    "newPassword": "NewPassword123"
  }'
```

### üéµ Gesti√≥n de Canciones

#### 1. Subir Canci√≥n

```bash
curl -X POST http://localhost:3000/api/songs \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -F "title=Mi Nueva Canci√≥n" \
  -F "albumId=album-uuid-optional" \
  -F "audioFile=@cancion.mp3"
```

#### 2. Listar Canciones P√∫blicas

```bash
curl -X GET "http://localhost:3000/api/songs?page=1&limit=10&search=rock&sortBy=play_count&sortOrder=DESC"
```

#### 3. Listar Mis Canciones (Privado)

```bash
curl -X GET http://localhost:3000/api/my/songs \
  -H "Authorization: Bearer YOUR_TOKEN"
```

**Respuesta incluye URLs de streaming:**
```json
{
  "songs": [
    {
      "id": "song-uuid",
      "title": "Mi Canci√≥n",
      "duration": 180,
      "playCount": 42,
      "isPublic": true,
      "artist": {
        "id": "artist-uuid",
        "name": "Mi Artista"
      },
      "album": {
        "id": "album-uuid",
        "title": "Mi √Ålbum"
      },
      "streaming": {
        "streamUrl": "/api/songs/song-uuid/stream",
        "downloadUrl": "/api/songs/song-uuid/download",
        "playerUrl": "/api/songs/song-uuid/player"
      }
    }
  ],
  "pagination": {
    "currentPage": 1,
    "totalPages": 5,
    "totalItems": 42
  }
}
```

#### 4. Actualizar Canci√≥n

```bash
curl -X PUT http://localhost:3000/api/songs/song-uuid \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "title": "T√≠tulo Actualizado",
    "isPublic": false
  }'
```

### üéß Streaming de Audio

#### 1. Stream Directo

```bash
# Stream completo
curl http://localhost:3000/api/songs/song-uuid/stream

# Stream con range (para seeking)
curl -H "Range: bytes=0-1023" http://localhost:3000/api/songs/song-uuid/stream
```

#### 2. Descarga de Archivo

```bash
curl -O http://localhost:3000/api/songs/song-uuid/download
```

#### 3. Reproductor Web

Abrir en navegador:
```
http://localhost:3000/api/songs/song-uuid/player
```

### üíø Gesti√≥n de √Ålbumes

#### 1. Crear √Ålbum

```bash
curl -X POST http://localhost:3000/api/albums \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "title": "Mi Nuevo √Ålbum",
    "description": "Descripci√≥n del √°lbum",
    "releaseDate": "2024-01-01",
    "genre": "Rock"
  }'
```

#### 2. Listar √Ålbumes P√∫blicos

```bash
curl -X GET "http://localhost:3000/api/albums?genre=rock&year=2024"
```

#### 3. Listar Mis √Ålbumes (Privado)

```bash
curl -X GET http://localhost:3000/api/my/albums \
  -H "Authorization: Bearer YOUR_TOKEN"
```

#### 4. Obtener √Ålbum con Canciones

```bash
curl -X GET http://localhost:3000/api/albums/album-uuid
```

### üîç B√∫squeda Avanzada

#### Par√°metros de B√∫squeda Disponibles

- `page`: N√∫mero de p√°gina (default: 1)
- `limit`: Items por p√°gina (default: 20, max: 100)
- `search`: B√∫squeda en t√≠tulos
- `artist`: Filtrar por artista
- `album`: Filtrar por √°lbum
- `genre`: Filtrar por g√©nero
- `year`: Filtrar por a√±o
- `sortBy`: Campo de ordenamiento (`created_at`, `title`, `play_count`, `duration`)
- `sortOrder`: Orden (`ASC`, `DESC`)

#### Ejemplo de B√∫squeda Compleja

```bash
curl -X GET "http://localhost:3000/api/songs?search=love&genre=pop&sortBy=play_count&sortOrder=DESC&limit=5"
```

## üß™ Testing

### Ejecutar Tests

#### Tests Unitarios

```bash
npm test
```

#### Tests de Integraci√≥n

```bash
npm run test:integration
```

#### Tests de Seguridad

```bash
npm run test:security
```

#### Tests End-to-End

```bash
npm run test:e2e
```

#### Coverage Report

```bash
npm run test:coverage
```

### Tests de Seguridad Espec√≠ficos

#### Ejecutar Suite Completa de Seguridad

```bash
./scripts/run-security-tests.sh
```

#### Tests OWASP Top 10

```bash
npm run test:security -- --testPathPattern=OWASP-Top10
```

#### Tests de Penetraci√≥n

```bash
npm run test:security -- --testPathPattern=penetration
```

## üìä Monitoreo y Logging

### Health Checks

```bash
# Health check b√°sico
curl http://localhost:3000/health

# Readiness probe
curl http://localhost:3000/health/ready

# Liveness probe
curl http://localhost:3000/health/live

# M√©tricas
curl http://localhost:3000/metrics
```

### Logs

Los logs se almacenan en:

- **Consola**: Desarrollo
- **Archivos**: `logs/` directory
- **Formato**: JSON estructurado

Ejemplo de log:

```json
{
  "timestamp": "2024-01-01T12:00:00.000Z",
  "level": "info",
  "message": "User authenticated",
  "userId": "user-123",
  "ip": "192.168.1.1",
  "userAgent": "Mozilla/5.0...",
  "requestId": "req-456"
}
```

## üîí Seguridad Implementada

### üõ°Ô∏è Autenticaci√≥n y Autorizaci√≥n

#### JWT Robusto
- **Tokens de acceso**: Expiraci√≥n corta (1 hora)
- **Refresh tokens**: Expiraci√≥n larga (7 d√≠as)
- **Algoritmo**: HS256 con secreto seguro
- **Payload**: userId, email, role con validaci√≥n

#### Control de Acceso
- **Separaci√≥n por usuario**: Endpoints `/my/*` solo muestran contenido propio
- **Validaci√≥n de propiedad**: Verificaci√≥n en todas las operaciones CRUD
- **Roles**: Sistema preparado para roles (user, admin)
- **Middleware de autenticaci√≥n**: Validaci√≥n autom√°tica de tokens

### üîê Protecci√≥n de Datos

#### Encriptaci√≥n
- **Contrase√±as**: bcrypt con 12 salt rounds
- **Validaci√≥n**: M√≠nimo 8 caracteres, may√∫scula, min√∫scula, n√∫mero
- **Bloqueo de cuentas**: Tras 5 intentos fallidos (15 minutos)

#### Validaci√≥n de Entrada
- **Joi schemas**: Validaci√≥n estricta de todos los inputs
- **Sanitizaci√≥n**: Limpieza autom√°tica de datos
- **Tipos MIME**: Validaci√≥n de archivos de audio
- **Tama√±os**: L√≠mite de 50MB para archivos

### üåê Protecci√≥n de Red

#### Rate Limiting Inteligente
```typescript
// Configuraci√≥n por endpoint:
{
  "/api/auth/*": "5 requests per 15 minutes",    // Autenticaci√≥n
  "/api/songs": "30 requests per minute",        // B√∫squeda
  "/api/songs (POST)": "10 requests per hour",   // Upload
  "/api/*": "100 requests per 15 minutes"        // General
}
```

#### Headers de Seguridad
```http
Strict-Transport-Security: max-age=31536000; includeSubDomains; preload
Content-Security-Policy: default-src 'self';script-src 'self'
X-Content-Type-Options: nosniff
X-Frame-Options: DENY
X-XSS-Protection: 1; mode=block
Referrer-Policy: strict-origin-when-cross-origin
```

#### CORS Configurado
- **Or√≠genes**: Configurables por ambiente
- **M√©todos**: GET, POST, PUT, DELETE, OPTIONS
- **Headers**: Authorization, Content-Type
- **Credentials**: Habilitado para autenticaci√≥n

### üìä Monitoreo y Auditor√≠a

#### Logging Estructurado
```json
{
  "timestamp": "2024-01-01T12:00:00.000Z",
  "level": "info",
  "message": "User logged in successfully",
  "userId": "uuid-123",
  "email": "user@example.com",
  "ip": "192.168.1.1",
  "userAgent": "Mozilla/5.0...",
  "service": "spotify-api",
  "environment": "production"
}
```

#### Eventos de Seguridad Monitoreados
- ‚úÖ Intentos de login (exitosos y fallidos)
- ‚úÖ Registro de nuevos usuarios
- ‚úÖ Cambios de contrase√±a
- ‚úÖ Accesos a archivos de audio
- ‚úÖ Violaciones de rate limiting
- ‚úÖ Errores de validaci√≥n
- ‚úÖ Intentos de acceso no autorizado

### üö® Prevenci√≥n de Ataques

#### Inyecciones SQL
- **Queries parametrizadas**: Uso exclusivo de prepared statements
- **ORM/Query Builder**: PostgreSQL con par√°metros seguros
- **Validaci√≥n**: Tipos de datos estrictos

#### XSS (Cross-Site Scripting)
- **CSP Headers**: Content Security Policy estricto
- **Sanitizaci√≥n**: Limpieza de inputs HTML
- **Encoding**: Escape autom√°tico de outputs

#### CSRF (Cross-Site Request Forgery)
- **SameSite Cookies**: Configuraci√≥n segura
- **Origin Validation**: Verificaci√≥n de headers
- **Token-based Auth**: JWT stateless

#### File Upload Security
- **Validaci√≥n MIME**: Solo archivos de audio permitidos
- **Extensiones**: Whitelist de extensiones (.mp3, .wav, .flac, .m4a)
- **Tama√±o**: L√≠mite de 50MB por archivo
- **Almacenamiento**: Fuera del webroot
- **Nombres**: UUID para evitar path traversal

### ‚öôÔ∏è Configuraci√≥n de Seguridad

#### Variables de Entorno Cr√≠ticas
```env
# JWT - Usar secreto fuerte en producci√≥n
JWT_SECRET=your-super-secret-jwt-key-minimum-32-characters-long

# Encriptaci√≥n - Ajustar seg√∫n recursos del servidor
BCRYPT_ROUNDS=12

# Rate Limiting - Ajustar seg√∫n tr√°fico esperado
RATE_LIMIT_WINDOW=900000  # 15 minutos
RATE_LIMIT_MAX=100        # requests por ventana

# Archivos - Limitar seg√∫n almacenamiento disponible
MAX_FILE_SIZE=52428800    # 50MB
```

#### Checklist de Seguridad para Producci√≥n
- [ ] JWT_SECRET con al menos 32 caracteres aleatorios
- [ ] HTTPS habilitado con certificados v√°lidos
- [ ] Base de datos con credenciales seguras
- [ ] Rate limiting configurado apropiadamente
- [ ] Logs de seguridad habilitados
- [ ] Backups autom√°ticos configurados
- [ ] Monitoreo de recursos activo
- [ ] Actualizaciones de seguridad programadas

## üõ†Ô∏è Desarrollo

### üìÅ Estructura del Proyecto (Arquitectura Hexagonal)

```
src/
‚îú‚îÄ‚îÄ server.ts                           # üöÄ Punto de entrada principal
‚îú‚îÄ‚îÄ infrastructure/                     # üîß Capa de infraestructura
‚îÇ   ‚îú‚îÄ‚îÄ config/                        # ‚öôÔ∏è Configuraciones
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ EnvironmentConfig.ts       # Variables de entorno
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ SecurityConfig.ts          # Configuraci√≥n de seguridad
‚îÇ   ‚îú‚îÄ‚îÄ database/                      # üóÑÔ∏è Adaptadores de base de datos
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ adapters/
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ PostgreSQLAdapter.ts   # Adaptador PostgreSQL
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ config/
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ DatabaseConfig.ts      # Configuraci√≥n DB
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ migrations/                # Migraciones SQL
‚îÇ   ‚îú‚îÄ‚îÄ logging/                       # üìä Sistema de logging
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ WinstonLogger.ts           # Logger estructurado
‚îÇ   ‚îú‚îÄ‚îÄ web/                          # üåê Capa web
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ controllers/               # üéÆ Controladores
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ AuthController.ts      # Autenticaci√≥n
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ UserController.ts      # Usuarios
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ SongController.ts      # Canciones + Streaming
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ AlbumController.ts     # √Ålbumes
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ routes/                    # üõ£Ô∏è Definici√≥n de rutas
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ authRoutes.ts          # Rutas de auth
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ userRoutes.ts          # Rutas de usuarios
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ musicRoutes.ts         # Rutas de m√∫sica
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ middleware/                # üõ°Ô∏è Middleware de seguridad
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ SecurityMiddleware.ts   # Headers y CORS
‚îÇ   ‚îú‚îÄ‚îÄ documentation/                 # üìö Documentaci√≥n
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ SwaggerGenerator.ts        # Generador Swagger
‚îÇ   ‚îî‚îÄ‚îÄ di/                           # üì¶ Inyecci√≥n de dependencias
‚îÇ       ‚îî‚îÄ‚îÄ DIContainer.ts             # Contenedor DI
‚îú‚îÄ‚îÄ shared/                           # üîÑ C√≥digo compartido
‚îÇ   ‚îú‚îÄ‚îÄ middleware/                   # üõ°Ô∏è Middleware personalizado
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ AuthenticationMiddleware.ts # JWT validation
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ValidationMiddleware.ts    # Joi validation
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ RateLimitingMiddleware.ts  # Rate limiting
‚îÇ   ‚îî‚îÄ‚îÄ errors/                       # ‚ùå Manejo de errores
‚îî‚îÄ‚îÄ uploads/                          # üìÅ Archivos subidos
    ‚îî‚îÄ‚îÄ songs/                        # üéµ Archivos de audio

docs/                                 # üìñ Documentaci√≥n adicional
‚îú‚îÄ‚îÄ API_DOCUMENTATION.md              # Gu√≠a completa de API
‚îú‚îÄ‚îÄ STREAMING_FEATURES.md             # Funcionalidades de streaming
‚îî‚îÄ‚îÄ architecture/                     # Diagramas de arquitectura
```

### üîß Scripts Disponibles

```bash
# üöÄ Desarrollo
npm run dev              # Servidor con hot reload y TypeScript
npm run dev:watch        # Modo watch con nodemon
npm run start:dev        # Alias para desarrollo

# üèóÔ∏è Construcci√≥n
npm run build            # Compilar TypeScript a JavaScript
npm run clean            # Limpiar directorio dist/
npm run type-check       # Verificar tipos sin compilar

# üß™ Testing (Preparado para implementar)
npm test                 # Tests unitarios con Jest
npm run test:watch       # Tests en modo watch
npm run test:coverage    # Reporte de cobertura
npm run test:security    # Tests de seguridad
npm run test:integration # Tests de integraci√≥n
npm run test:e2e         # Tests end-to-end

# üìä Calidad de c√≥digo
npm run lint             # ESLint para TypeScript
npm run lint:fix         # Fix autom√°tico de ESLint
npm run format           # Prettier para formateo
npm run format:check     # Verificar formato sin cambios

# üîí Seguridad
npm run security:audit   # Auditor√≠a de dependencias NPM
npm audit                # Auditor√≠a b√°sica

# üóÑÔ∏è Base de datos
npm run migrate          # Ejecutar migraciones (JavaScript)
npm run migrate:ts       # Ejecutar migraciones (TypeScript)
npm run db:setup         # Configurar base de datos completa

# üê≥ Docker
npm run docker:build     # Construir imagen Docker
npm run docker:run       # Ejecutar contenedor
```

### üéØ Endpoints Implementados

#### üîê Autenticaci√≥n (`/api/auth`)
- `POST /register` - Registro de usuarios
- `POST /login` - Inicio de sesi√≥n
- `POST /logout` - Cerrar sesi√≥n
- `POST /refresh` - Renovar token

#### üë§ Usuarios (`/api/users`)
- `GET /profile` - Obtener perfil
- `PUT /profile` - Actualizar perfil
- `DELETE /profile` - Eliminar cuenta

#### üéµ Canciones (`/api/songs` y `/api/my/songs`)
- `GET /songs` - Listar canciones p√∫blicas
- `GET /my/songs` - Listar mis canciones (privado)
- `POST /songs` - Subir canci√≥n
- `GET /songs/:id` - Obtener canci√≥n espec√≠fica
- `PUT /songs/:id` - Actualizar canci√≥n (propietario)
- `DELETE /songs/:id` - Eliminar canci√≥n (propietario)

#### üéß Streaming (`/api/songs/:id`)
- `GET /songs/:id/stream` - Stream de audio con range requests
- `GET /songs/:id/download` - Descarga de archivo
- `GET /songs/:id/player` - Reproductor web HTML5

#### üíø √Ålbumes (`/api/albums` y `/api/my/albums`)
- `GET /albums` - Listar √°lbumes p√∫blicos
- `GET /my/albums` - Listar mis √°lbumes (privado)
- `POST /albums` - Crear √°lbum
- `GET /albums/:id` - Obtener √°lbum con canciones
- `PUT /albums/:id` - Actualizar √°lbum (propietario)
- `DELETE /albums/:id` - Eliminar √°lbum (propietario)

#### üîç Sistema (`/api`)
- `GET /` - Informaci√≥n de la API
- `GET /health` - Health check b√°sico
- `GET /health/ready` - Readiness probe
- `GET /health/live` - Liveness probe
- `GET /metrics` - M√©tricas del sistema
- `GET /docs` - Documentaci√≥n Swagger

### üèóÔ∏è Patrones de Arquitectura Implementados

#### üèõÔ∏è Arquitectura Hexagonal
- **Dominio**: L√≥gica de negocio pura (preparado para implementar)
- **Aplicaci√≥n**: Casos de uso y orquestaci√≥n (preparado)
- **Infraestructura**: Adaptadores y detalles t√©cnicos (implementado)
- **Puertos**: Interfaces para inversi√≥n de dependencias

#### üì¶ Inyecci√≥n de Dependencias
- **DIContainer**: Contenedor personalizado para gesti√≥n de dependencias
- **Factory Pattern**: Creaci√≥n controlada de instancias
- **Singleton**: Para servicios compartidos (Logger, DB)

#### üõ°Ô∏è Middleware Chain
- **Seguridad**: Headers, CORS, Rate Limiting
- **Autenticaci√≥n**: JWT validation
- **Validaci√≥n**: Joi schemas
- **Logging**: Request/Response logging
- **Error Handling**: Manejo centralizado de errores

### Contribuir

#### 1. Fork y Clone

```bash
git clone https://github.com/tu-usuario/spotify-api-security.git
cd spotify-api-security
```

#### 2. Crear Branch

```bash
git checkout -b feature/nueva-funcionalidad
```

#### 3. Desarrollar

```bash
# Instalar dependencias
npm install

# Ejecutar tests
npm test

# Verificar seguridad
npm run security:check
```

#### 4. Commit y Push

```bash
git add .
git commit -m "feat: nueva funcionalidad"
git push origin feature/nueva-funcionalidad
```

## üìñ Documentaci√≥n Completa

### üìö Documentaci√≥n de API

- **üåê Swagger UI**: http://localhost:3000/api/docs
- **üìã API Info**: http://localhost:3000/api
- **‚ù§Ô∏è Health Check**: http://localhost:3000/api/health
- **üìä M√©tricas**: http://localhost:3000/api/metrics

### üìÅ Documentaci√≥n del Proyecto

- **üìñ [API_DOCUMENTATION.md](API_DOCUMENTATION.md)** - Gu√≠a completa de uso de la API
- **üéµ [STREAMING_FEATURES.md](STREAMING_FEATURES.md)** - Funcionalidades de streaming de audio
- **üèóÔ∏è Arquitectura Hexagonal** - Implementada con separaci√≥n clara de capas
- **üîí Seguridad** - Implementaci√≥n completa de mejores pr√°cticas

### üéØ Funcionalidades Destacadas

#### üéß Sistema de Streaming Avanzado
- **Range Requests**: Soporte completo para seeking y carga progresiva
- **Reproductor Web**: HTML5 player integrado y responsivo
- **Descarga Segura**: Archivos con nombres limpios
- **Metadatos**: Headers HTTP con informaci√≥n de la canci√≥n
- **Cache Inteligente**: Optimizaci√≥n de rendimiento

#### üõ°Ô∏è Seguridad Empresarial
- **Separaci√≥n de Usuarios**: Aislamiento completo de datos por usuario
- **Rate Limiting**: Protecci√≥n inteligente por endpoint
- **Validaci√≥n Robusta**: Joi schemas para todos los inputs
- **Logging de Auditor√≠a**: Registro completo de eventos de seguridad
- **JWT Seguro**: Tokens con expiraci√≥n y refresh autom√°tico

#### üèóÔ∏è Arquitectura Profesional
- **TypeScript**: Tipado est√°tico completo
- **Arquitectura Hexagonal**: Separaci√≥n clara de responsabilidades
- **DI Container**: Inyecci√≥n de dependencias personalizada
- **Error Handling**: Manejo centralizado y estructurado
- **Swagger**: Documentaci√≥n autom√°tica y actualizada

### üöÄ Demo y Ejemplos

#### Flujo Completo de Usuario
```bash
# 1. Registrar usuario
curl -X POST http://localhost:3000/api/auth/register \
  -H "Content-Type: application/json" \
  -d '{"email":"demo@example.com","password":"Demo123","name":"Demo User"}'

# 2. Crear √°lbum
curl -X POST http://localhost:3000/api/albums \
  -H "Authorization: Bearer TOKEN" \
  -H "Content-Type: application/json" \
  -d '{"title":"Mi √Ålbum Demo","genre":"Rock"}'

# 3. Subir canci√≥n
curl -X POST http://localhost:3000/api/songs \
  -H "Authorization: Bearer TOKEN" \
  -F "title=Canci√≥n Demo" \
  -F "albumId=ALBUM_ID" \
  -F "audioFile=@demo.mp3"

# 4. Reproducir en navegador
open http://localhost:3000/api/songs/SONG_ID/player
```

#### Integraci√≥n con JavaScript
```javascript
// Obtener canciones con URLs de streaming
const response = await fetch('/api/songs');
const data = await response.json();

data.songs.forEach(song => {
  // Crear reproductor HTML5
  const audio = new Audio(song.streaming.streamUrl);
  
  // Mostrar informaci√≥n
  console.log(`${song.title} - ${song.artist.name}`);
  console.log(`Stream: ${song.streaming.streamUrl}`);
  console.log(`Player: ${song.streaming.playerUrl}`);
});
```

### üéì Para Educaci√≥n y Demostraci√≥n

#### Conceptos T√©cnicos Demostrados
- ‚úÖ **Arquitectura Hexagonal** en Node.js/TypeScript
- ‚úÖ **Seguridad Web** con JWT, Rate Limiting, Validaci√≥n
- ‚úÖ **Streaming de Audio** con HTTP Range Requests
- ‚úÖ **API RESTful** con documentaci√≥n Swagger
- ‚úÖ **Separaci√≥n de Usuarios** y autorizaci√≥n granular
- ‚úÖ **Upload de Archivos** seguro con validaci√≥n
- ‚úÖ **Logging Estructurado** para auditor√≠a
- ‚úÖ **Inyecci√≥n de Dependencias** personalizada
- ‚úÖ **Manejo de Errores** centralizado
- ‚úÖ **Base de Datos** PostgreSQL con migraciones

#### Casos de Uso Reales
- üéµ **Plataforma de M√∫sica** como Spotify/Apple Music
- üéß **Streaming de Audio** con controles avanzados
- üë• **Multi-tenant** con separaci√≥n de usuarios
- üîí **Aplicaci√≥n Segura** con autenticaci√≥n robusta
- üì± **API Backend** para aplicaciones m√≥viles/web
- üè¢ **Sistema Empresarial** con logging y monitoreo

## ü§ù Soporte

### Reportar Issues

- **GitHub Issues**: Para bugs y feature requests
- **Security Issues**: security@spotify-api.com
- **General Support**: support@spotify-api.com

### Comunidad

- **Discord**: [Servidor de Discord](https://discord.gg/spotify-api)
- **Stack Overflow**: Tag `spotify-api-security`
- **Reddit**: r/SpotifyApiSecurity

## üìÑ Licencia

Este proyecto est√° licenciado bajo la Licencia MIT - ver el archivo [LICENSE](LICENSE) para detalles.

## üôè Agradecimientos

- **OWASP** por las gu√≠as de seguridad
- **Node.js Security Working Group** por las mejores pr√°cticas
- **Comunidad Open Source** por las herramientas y librer√≠as

## üìä Estado del Proyecto

### ‚úÖ Funcionalidades Completamente Implementadas

- üîê **Sistema de Autenticaci√≥n JWT** completo con refresh tokens
- üë§ **Gesti√≥n de Usuarios** con perfiles y estad√≠sticas
- üéµ **Upload y Gesti√≥n de Canciones** con validaci√≥n de archivos
- üíø **Gesti√≥n de √Ålbumes** con metadatos completos
- üéß **Streaming de Audio** con Range Requests y reproductor web
- üõ°Ô∏è **Separaci√≥n de Usuarios** - endpoints privados y p√∫blicos
- üîç **B√∫squeda Avanzada** con filtros y paginaci√≥n
- üìä **Rate Limiting** inteligente por endpoint
- üîí **Validaci√≥n Robusta** con Joi schemas
- üìù **Logging de Auditor√≠a** estructurado con Winston
- üìö **Documentaci√≥n Swagger** completa y actualizada
- üèóÔ∏è **Arquitectura Hexagonal** con DI Container

### üöÄ Listo para Producci√≥n

- ‚úÖ **Seguridad**: Implementaci√≥n completa de mejores pr√°cticas
- ‚úÖ **Performance**: Cache headers, streaming optimizado
- ‚úÖ **Escalabilidad**: Arquitectura preparada para crecimiento
- ‚úÖ **Monitoreo**: Health checks y m√©tricas integradas
- ‚úÖ **Documentaci√≥n**: Swagger UI y gu√≠as completas
- ‚úÖ **Testing**: Estructura preparada para tests comprehensivos

### üéØ Casos de Uso Ideales

- üìö **Educaci√≥n**: Demostraci√≥n de arquitectura y seguridad web
- üè¢ **Empresarial**: Base para aplicaciones de streaming
- üéµ **M√∫sica**: Plataforma completa de gesti√≥n musical
- üì± **Mobile/Web**: Backend API para aplicaciones cliente
- üîí **Seguridad**: Ejemplo de implementaci√≥n segura

### üõ†Ô∏è Tecnolog√≠as Utilizadas

| Categor√≠a | Tecnolog√≠a | Prop√≥sito |
|-----------|------------|-----------|
| **Runtime** | Node.js 18+ | Servidor JavaScript |
| **Lenguaje** | TypeScript 5+ | Tipado est√°tico |
| **Framework** | Express.js | Framework web |
| **Base de Datos** | PostgreSQL | Almacenamiento principal |
| **Autenticaci√≥n** | JWT + bcrypt | Seguridad de usuarios |
| **Validaci√≥n** | Joi | Validaci√≥n de esquemas |
| **Logging** | Winston | Logging estructurado |
| **Upload** | Multer | Manejo de archivos |
| **Documentaci√≥n** | Swagger/OpenAPI | API docs |
| **Arquitectura** | Hexagonal | Separaci√≥n de capas |

---

### üéâ **¬°Proyecto Completamente Funcional!**

Esta API de streaming de m√∫sica est√° **lista para demostraci√≥n y uso en producci√≥n**, implementando:

- ‚úÖ **Todas las funcionalidades b√°sicas** de una plataforma de m√∫sica
- ‚úÖ **Seguridad de nivel empresarial** con mejores pr√°cticas
- ‚úÖ **Streaming de audio avanzado** con reproductor web
- ‚úÖ **Arquitectura profesional** escalable y mantenible
- ‚úÖ **Documentaci√≥n completa** para desarrolladores

**‚ö†Ô∏è Nota de Seguridad**: Esta aplicaci√≥n implementa m√∫ltiples capas de seguridad siguiendo las mejores pr√°cticas de la industria. Mant√©n siempre las dependencias actualizadas y realiza auditor√≠as regulares.

**üîí Recuerda**: La seguridad es un proceso continuo, no un destino.

**üéµ ¬°Disfruta explorando y aprendiendo con esta API completa de streaming musical!** üéµ
